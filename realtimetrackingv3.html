<!DOCTYPE html >
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>PHP/MySQL Example</title>
 <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAclK0B2lXQwV5lPy1rLiTFBSN1aiKepvDswXjKa4j2DDWdYvOjhQMO1tywqS8ObgP5dtO70AyyArhzA"
        type="text/javascript">
    </script>


<script language="JavaScript">
 
 
var infoWindow;

function setTimer() {
   console.log("Settime.");
   window.setTimeout("show_data();",5000);
}
 
function show_data(){
	console.log("Show data.");

   //Append the id (just a simple count) to the requestURL
   var requestURL = "http://localhost/getGpsPoints.php";
   var count = document.getElementById("counter").value;
   count = parseInt(count, 10);
   var queries = "?id=1" ;
   var url = requestURL + queries;
 
   //Increment the hidden counter variable
   document.getElementById("counter").value = count+1; 
 
   var request = GXmlHttp.create();
   request.open("GET", url, true);
 
   request.onreadystatechange = function() {
      if (request.readyState == 4) {
         var xmlDoc = request.responseXML;
         var markers = xmlDoc.documentElement.getElementsByTagName("marker");
 
         for (var i = 0; i < markers.length; i++) {
            var point = new GPoint(parseFloat(markers[i].getAttribute("lat")), parseFloat(markers[i].getAttribute("lng")));
 
            // Draw the MapMarker
            var mapMarker = new GMarker(point);
            map.addOverlay(mapMarker);
         }
 
         // Recenter the map
         map.setCenter(new GLatLng(point),8)
      }
   }
 
   request.send(null);
 
   //Reset the timer so that the page keeps refreshing itself
   setTimer();
}



</script>
</head>

<body>
<div id="map" style="width: 100%; height: 100%"></div>
<div id="counter"></div>
<script language="JavaScript">
   var query = window.location.pathname;
   var map = new GMap2(document.getElementById("map"));
   
	console.log("Running map setup");
      setTimer();
</script>


</body>
</html>
